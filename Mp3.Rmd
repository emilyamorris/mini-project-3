---
title: "Mini_project_3"
author: "Emily M., Sylvie L., and Hannah R.D."
date: "April 3, 2018"
output: html_document
---

```{r}
library(tidyverse)
library(leaflet)
library(sf)
library(macleish)
```

```{r}
#Attaining the orchard live weather data from Professor Baumer's R package (this part is not our code)
macleish <- etl("macleish")
macleish %>%
  etl_update()
whately <- macleish %>%
  tbl("whately")
whately %>%
  mutate(the_year = strftime('%Y', when)) %>%
  group_by(the_year) %>%
  summarize(N = n(), begin = min(when), end = max(when), avg_temp = mean(temperature))
orchard <- macleish %>%
  tbl("orchard")
orchard %>%
  mutate(the_year = strftime('%Y', when)) %>%
  group_by(the_year) %>%
  summarize(N = n(), begin = min(when), end = max(when), avg_temp = mean(temperature))

#Collecting the wild not-data sets that orchard and whately are, getting the sap data and the forest data (this part is our code)
orchard_data <-collect(orchard)
whately_data <- collect(whately)
sap <- macleish::maple_sap
forests <- macleish_layers[["forests"]]
```

```{r}
#What types of maple forests are there? Where are they?

forests <- forests%>%
  rename("forest_type"="Sheet1__Na")%>%
  mutate(area= st_area(forests))

forest_areas <- forests %>%
  group_by(forest_type)%>%
  summarise(total_area= sum(area))%>%
  filter(str_detect(forest_type, "Maple"))

#Making a palette for the two types of Maple forests
fm_pal <- colorFactor(
  palette= c('#42f47a', '#137a33'),
  domain= forest_areas$forest_type
)

#Leaflet plot to map where the maple forests are

leaflet()%>%
  addTiles()%>%
  addPolygons(data=forest_areas, color= ~fm_pal(forest_type))
  
```

```{r}
#Wrangling the orchard and whately data

orchard_data$Date <- format(as.POSIXct(orchard_data$when, format= "%Y-%m-%dT%H:%M:%SZ"), "%Y-%m-%d")
orchard_data$Time <- format(as.POSIXct(orchard_data$when, format="%Y-%m-%dT%H:%M:%SZ"), "%H:%M:%S")
whately_data$Date <- format(as.POSIXct(whately_data$when,format=("%Y-%m-%dT%H:%M:%SZ")),"%Y-%m-%d")
whately_data$Time <- format(as.POSIXct(whately_data$when, format="%Y-%m-%dT%H:%M:%SZ"), "%H:%M:%S")
```

```{r}
#more wrangling